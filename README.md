# Compounding Engineering Plugin (DSPy Edition)

A Python implementation of the [Compounding Engineering Plugin](https://github.com/EveryInc/compounding-engineering-plugin) using [DSPy](https://github.com/stanfordnlp/dspy).

## What Is Compounding Engineering?

**Each unit of engineering work should make subsequent units of work easier‚Äînot harder.**

This CLI tool provides AI-powered development tools for code review, planning, and workflow automation, following the compounding engineering philosophy. It is designed as a **Local-First** tool that runs on your machine, keeping your code secure while leveraging powerful LLMs.

## Features

- **üîç Multi-Agent Code Review**: Run 10+ specialized review agents in parallel
  - **Security Sentinel**: Detects vulnerabilities (SQLi, XSS, etc.)
  - **Performance Oracle**: Identifies bottlenecks and O(n) issues
  - **Architecture Strategist**: Reviews design patterns and SOLID principles
  - **Data Integrity Guardian**: Checks transaction safety and validation
  - And many more...

- **üõ°Ô∏è Secure Work Execution**: Safely execute AI-generated plans
  - **Isolated Worktrees**: All changes happen in isolated git worktrees
  - **Safe Testing**: Tests run in isolation before changes are merged
  - **Zero Risk**: Your main working directory is never directly modified

- **üìã Smart Planning**: Transform feature descriptions into detailed plans
  - Repository research & pattern analysis
  - Framework documentation integration
  - SpecFlow user journey analysis

- **‚úÖ Interactive Triage**: Manage code review findings
  - **Batch Operations**: Approve multiple findings at once
  - **Smart Priorities**: Auto-detection of P1/P2/P3 severity
  - **Work Logs**: Tracks decisions and rationale automatically

## Installation

### Prerequisites

Install [uv](https://github.com/astral-sh/uv) (fast Python package installer):

```bash
curl -LsSf https://astral.sh/uv/install.sh | sh
```

### Setup

```bash
# Clone repository
git clone https://github.com/Dan-StrategicAutomation/dspy-compounding-engineering.git
cd dspy-compounding-engineering

# Configure environment
cp .env.example .env
# Edit .env with your API keys (OpenAI, Anthropic, or Ollama)

# Install dependencies
uv sync
```

## Roadmap & Missing Features

While the core agentic workflows are fully functional, some integrations present in the original plugin are currently **unimplemented** or **simplified**:

- ‚ùå **GitHub Integration**: Currently, the tool does not create GitHub Issues, post PR comments, or manage GitHub Projects. It operates entirely on local files.
- ‚ùå **Smart Context Gathering**: The planning workflow uses a basic file listing strategy. It does not yet use vector search or smart dependency graph analysis to find relevant context.
- ‚ùå **Comprehensive Testing**: While `work.py` runs tests, there is no robust test runner integration or coverage reporting.
- ‚ùå **IDE Integration**: No VS Code or JetBrains plugins yet.

## Configuration

Edit `.env` to configure your LLM provider:

```bash
# OpenAI
DSPY_LM_PROVIDER=openai
DSPY_LM_MODEL=gpt-4o
OPENAI_API_KEY=sk-...

# Anthropic
DSPY_LM_PROVIDER=anthropic
DSPY_LM_MODEL=claude-3-5-sonnet-20241022
ANTHROPIC_API_KEY=sk-ant-...

# Ollama (Local)
DSPY_LM_PROVIDER=ollama
DSPY_LM_MODEL=qwen2.5-coder:14b
```

## Usage

### 1. Review Code

Run a comprehensive multi-agent review on your current changes:

```bash
# Review latest local changes
uv run python cli.py review

# Review entire project (not just changes)
uv run python cli.py review --project

# Review a specific PR (requires gh cli)
uv run python cli.py review https://github.com/user/repo/pull/123
```

### 2. Triage Findings

Process the findings generated by the review:

```bash
uv run python cli.py triage
```

- **Yes**: Approve and convert to ready todo
- **Next**: Skip or delete
- **All**: Batch approve all remaining items
- **Custom**: Change priority or details

### 3. Resolve Todos

Automatically resolve ready todos using AI agents in isolated worktrees:

```bash
# Resolve all ready todos
uv run python cli.py resolve-todo

# Resolve todos matching a pattern (e.g., P1 priority)
uv run python cli.py resolve-todo p1

# Preview changes without applying (dry run)
uv run python cli.py resolve-todo --dry-run

# Run sequentially instead of in parallel
uv run python cli.py resolve-todo --sequential
```

This will:

1. Find all `*-ready-*.md` todos matching the pattern
2. Analyze dependencies between todos
3. Create an isolated worktree with a new branch
4. Resolve each todo using AI agents
5. Mark todos as complete (`*-complete-*.md`)
6. Commit changes and provide PR instructions

### 4. Generate Commands

Generate shell commands from natural language descriptions:

```bash
# Generate a command
uv run python cli.py generate-command "find all Python files modified in the last week"

# Execute the generated command (use with caution)
uv run python cli.py generate-command "list large files" --execute
```

### 5. Plan New Features

Generate a detailed implementation plan:

```bash
uv run python cli.py plan "Add user authentication with OAuth"
```

### 6. Execute Work

Execute a plan or todo file in a secure, isolated environment:

```bash
uv run python cli.py work plans/my-feature.md
```

This will:

1. Create a `feature/<name>` branch
2. Create an isolated worktree in `worktrees/`
3. Implement the changes and run tests
4. Clean up the worktree upon completion

## Architecture

```text
dspy-compounding-engineering/
‚îú‚îÄ‚îÄ agents/                  # DSPy Signatures
‚îÇ   ‚îú‚îÄ‚îÄ review/              # 10+ Review Agents
‚îÇ   ‚îú‚îÄ‚îÄ research/            # Research & Analysis Agents
‚îÇ   ‚îî‚îÄ‚îÄ workflow/            # Execution & Triage Agents
‚îú‚îÄ‚îÄ workflows/               # Command Logic
‚îÇ   ‚îú‚îÄ‚îÄ review.py            # Parallel review orchestration
‚îÇ   ‚îú‚îÄ‚îÄ resolve_todo.py      # AI-powered todo resolution
‚îÇ   ‚îú‚îÄ‚îÄ generate_command.py  # Natural language ‚Üí shell commands
‚îÇ   ‚îú‚îÄ‚îÄ work.py              # Secure worktree execution
‚îÇ   ‚îî‚îÄ‚îÄ plan.py              # Research & planning
‚îú‚îÄ‚îÄ utils/                   # Core Utilities
‚îÇ   ‚îú‚îÄ‚îÄ git_service.py       # Git & Worktree management
‚îÇ   ‚îú‚îÄ‚îÄ safe_io.py           # Secure file operations
‚îÇ   ‚îî‚îÄ‚îÄ todo_service.py      # Structured todo generation
‚îî‚îÄ‚îÄ cli.py                   # Typer CLI entry point
```

## Philosophy

Based on the [Compounding Engineering](https://every.to/source-code/my-ai-had-already-fixed-the-code-before-i-saw-it) philosophy:

- **Plan ‚Üí Delegate ‚Üí Assess ‚Üí Codify**
- Systematic beats heroic
- Quality compounds over time

## Comparison with Original Plugin

| Feature | Original Plugin | This DSPy Edition |
|---------|-----------------|-------------------|
| **Runtime** | Claude Code Plugin | Standalone Python CLI |
| **LLM** | Claude Only | OpenAI, Anthropic, Ollama |
| **Execution** | Direct File Edit | **Secure Git Worktrees** |
| **Integration**| GitHub App | Local-First CLI |

## License

MIT

## Credits

Original concept by [Kieran Klaassen](https://github.com/kieranklaassen) at [Every.to](https://every.to).
DSPy framework by [Stanford NLP Group](https://github.com/stanfordnlp/dspy).
